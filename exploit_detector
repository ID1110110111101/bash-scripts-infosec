#!/bin/bash

# you can run this script by providing an IP address as an argument:
# ./exploit_detector IP


if [ -z "$1" ]
  then
    echo "Please provide an IP address to scan."
    exit 1
fi

ip=$1

echo "Scanning $ip with Nmap..."

# Run Nmap with version detection on all ports
nmap -sV $ip -oN nmap-scan.txt

echo "Checking for known exploits with searchsploit..."

# Use awk to extract software names from the Nmap output, then pipe to searchsploit
awk '/^ *[0-9]+\/tcp/ {service=$NF; getline; if ($0 ~ /Version:/) {split($0,a,"Version:"); split(a[2],b,","); version=b[1]} else {version=""}; printf "%s %s\n", $NF, version}' nmap-scan.txt | sort -u | while read line; do
    software=$(echo $line | cut -d ' ' -f 1)
    version=$(echo $line | cut -d ' ' -f 2)
    searchsploit "$software"
done

echo "Scan complete."
